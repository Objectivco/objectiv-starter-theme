{# Create a variable width responsive image #}
{% macro responsive(assetId, options={}) %}
    {# merge the options with options parameter #}
    {% set options = {
        alt: 'alt',
        class: [],
        style: 'default',
    } | merge(options) %}

    {# Get the asset meta data from WP #}
    {% set assetArray = function('wp_get_attachment_image_src', assetId, 'full') %}
    {% set assetUrl = assetArray[0] %}
    {% set assetMetaData = function('wp_get_attachment_metadata', assetId) %}
    {% set assetNativeWidth = assetmetaData.width %}

    {# Image Config
     # Make sure to update the configs to what fits for each site.
     #}
    {% set config = {
        default: {
            srcsetWidths: [640, 1024, 1600],
            sizes: [
                '(min-width: 900px) 1025px',
                '100vw'
            ],
            defaultWidth: 1024
        }
    } %}

    {# Let's get the style that is sent through as parameter #}
    {% set params = config[options.style] %}
    {% set srcset = [] %}

    {# Create the srcset #}
    {% for width in params['srcsetWidths'] %}
        {% set srcset = srcset|merge([assetUrl|resize(width) ~ ' ' ~ width ~ 'w']) %}
    {% endfor %}

    <img 
        {% if (assetNativeWidth <= params['defaultWidth']) %}
            src="{{assetUrl}}"
        {% else %}
            src="{{assetUrl|resize(width)}}"
        {% endif %}

        srcset="{{srcset|join(', ')}}"
        sizes="{{params['sizes']|join(', ')}}"
    />

{% endmacro %}